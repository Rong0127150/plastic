<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Level 5 - ç’°å¢ƒå®ˆè­·è€…æŒ‘æˆ°</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      text-align: center;
      background-color: #e0f7fa;
      padding: 20px;
    }
    h1 {
      font-size: 2em;
    }
    #musicToggleBtn {
      margin-bottom: 20px;
      padding: 8px 16px;
      font-size: 1rem;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background-color: #0288d1;
      color: white;
      transition: background-color 0.3s;
    }
    #musicToggleBtn:hover {
      background-color: #01579b;
    }
    #counter, #timer {
      font-size: 1.2rem;
      margin: 10px;
      font-weight: bold;
    }
    .emoji {
      font-size: 3rem;
      margin: 15px;
      cursor: pointer;
      transition: transform 0.2s;
      display: inline-block;
    }
    .emoji:hover {
      transform: scale(1.3);
    }
    .collected {
      opacity: 0.4;
      pointer-events: none;
    }
    #message {
      font-size: 1.5rem;
      margin-top: 20px;
      min-height: 2em;
    }
    #retryBtn, #restartBtn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 1rem;
      border: none;
      border-radius: 5px;
      background-color: #0288d1;
      color: white;
      display: none;
      cursor: pointer;
    }
    #retryBtn:hover, #restartBtn:hover {
      background-color: #01579b;
    }
  </style>
</head>
<body>

  <audio id="bg-music" src="images/music.mp3" loop></audio>
  
  <h1>ğŸŒ Level 5ï¼šç’°å¢ƒå®ˆè­·è€…æŒ‘æˆ°</h1>
  <button id="musicToggleBtn">ğŸ”ˆ é–‹å•ŸéŸ³æ¨‚</button>

  <p>åœ¨ 30 ç§’å…§æ‰¾å‡º 6 å€‹å¯å›æ”¶ç‰©å“ï¼Œé»éŒ¯æˆ–æ™‚é–“åˆ°å°±å¤±æ•—ï¼</p>

  <div id="counter">å·²æ”¶é›†ï¼š0 / 6</div>
  <div id="timer">å‰©é¤˜æ™‚é–“ï¼š30 ç§’</div>

  <div id="emojiZone"></div>

  <div id="message"></div>
  <button id="retryBtn" onclick="location.reload()">é‡æ–°æŒ‘æˆ°</button>
  <button id="restartBtn" onclick="location.href='level1.html'">å†ç©ä¸€æ¬¡å¾é ­é–‹å§‹</button>

  <script>
    const bgm = document.getElementById('bg-music');
    const musicToggleBtn = document.getElementById('musicToggleBtn');
    let musicOn = false;

    musicToggleBtn.addEventListener('click', () => {
      if (musicOn) {
        bgm.pause();
        musicToggleBtn.textContent = "ğŸ”ˆ é–‹å•ŸéŸ³æ¨‚";
      } else {
        bgm.play().catch(() => {});
        musicToggleBtn.textContent = "ğŸ”Š é—œé–‰éŸ³æ¨‚";
      }
      musicOn = !musicOn;
    });

    const emojis = [
      { icon: "ğŸ¥«", recyclable: true },
      { icon: "ğŸ’¥", recyclable: false },
      { icon: "ğŸ", recyclable: true },
      { icon: "ğŸ¥©", recyclable: false },
      { icon: "ğŸ¥«", recyclable: true },
      { icon: "ğŸ›¸", recyclable: false },
      { icon: "ğŸ´", recyclable: true },
      { icon: "ğŸ§", recyclable: false },
      { icon: "ğŸ‘“", recyclable: true },
      { icon: "ğŸ¥", recyclable: false },
      { icon: "ğŸ¨", recyclable: true },
      { icon: "ğŸ¥š", recyclable: false }
    ];

    const targetCount = 6;
    let collected = 0;
    let gameOver = false;
    let timeLeft = 30;
    const zone = document.getElementById("emojiZone");

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function startGame() {
      shuffle(emojis).forEach((item) => {
        const span = document.createElement("span");
        span.className = "emoji";
        span.innerText = item.icon;
        span.dataset.recyclable = item.recyclable;
        span.onclick = () => handleClick(span);
        zone.appendChild(span);
      });
    }

    function handleClick(el) {
      if (gameOver || el.classList.contains("collected")) return;
      const isRecyclable = el.dataset.recyclable === "true";
      if (isRecyclable) {
        el.classList.add("collected");
        collected++;
        document.getElementById("counter").innerText = `å·²æ”¶é›†ï¼š${collected} / ${targetCount}`;
        if (collected === targetCount) {
          winGame();
        }
      } else {
        loseGame("âŒ ä½ é»éŒ¯äº†ï¼æŒ‘æˆ°å¤±æ•—ï¼");
      }
    }

    function winGame() {
      gameOver = true;
      document.getElementById("message").style.color = "green";
      document.getElementById("message").innerText = "ğŸ‰ æ­å–œä½ å®Œæˆå…¨éƒ¨é—œå¡ï¼";
      document.getElementById("restartBtn").style.display = "inline-block";
    }

    function loseGame(msg) {
      gameOver = true;
      document.getElementById("message").style.color = "red";
      document.getElementById("message").innerText = msg;
      document.getElementById("retryBtn").style.display = "inline-block";
    }

    function startTimer() {
      const timerDisplay = document.getElementById("timer");
      const timer = setInterval(() => {
        if (gameOver) {
          clearInterval(timer);
          return;
        }
        timeLeft--;
        timerDisplay.innerText = `å‰©é¤˜æ™‚é–“ï¼š${timeLeft} ç§’`;
        if (timeLeft === 0) {
          clearInterval(timer);
          loseGame("âŒ› æ™‚é–“åˆ°äº†ï¼æŒ‘æˆ°å¤±æ•—ï¼");
        }
      }, 1000);
    }

    startGame();
    startTimer();
  </script>
</body>
</html>
